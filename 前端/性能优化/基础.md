# 概念

### DOMContentLoaded

https://zhuanlan.zhihu.com/p/25876048 

DOMContentLoaded可以看作是网页从空白到出现内容所花费的时间。 当一个 **HTML 文档被加载和解析完成后**，DOMContentLoaded 事件便会被触发。 Loaded事件是在网页所有内容加载完毕后触发。

> MDN：当初始的 **HTML** 文档被完全加载和解析完成之后，**`DOMContentLoaded`** 事件被触发，而无需等待样式表、图像和子框架的完全加载。另一个不同的事件 `load `应该仅用于检测一个完全加载的页面。 这里有一个常见的错误，就是在本应使用 `DOMContentLoaded` 会更加合适的情况下，却选择使用 [`load`](https://developer.mozilla.org/en-US/docs/Mozilla_event_reference/load)，所以要谨慎。注意：**`DOMContentLoaded`** 事件必须等待其所属script之前的样式表加载解析完成才会触发。 

注意上面最后一句话：<font color='red'>必须等待所属script之前的样式表加载解析完成才会触发。</font>

解析过程如下：

<img src="img/domcontentloaded1.png" alt="domcontentloaded1" style="zoom:50%;" />

#### 普通脚本

![domcontentloaded_normal](img/domcontentloaded_normal.png)

当 HTML 文档被解析时如果遇见（同步）脚本，则停止解析，先去加载脚本，然后执行，执行结束后继续解析 HTML 文档。 

#### Defer脚本

![domcontentloaded_defer](img/domcontentloaded_defer.png)

当 HTML 文档被解析时如果遇见 defer 脚本，则在后台加载脚本，文档解析过程不中断，而等文档解析结束之后，defer 脚本执行（延迟执行）。另外，defer 脚本的执行顺序与定义时的位置有关。 

defer标签的脚本不会影响 HTML 文档的解析，而是等到 HTML 解析完成后才会执行。而 DOMContentLoaded 只有在 defer 脚本执行结束后才会被触发。 所以这意味着什么呢？HTML 文档解析不受影响，等 DOM 构建完成之后 defer 脚本执行，但脚本执行之前需要等待 CSSOM 构建完成。在 DOM、CSSOM 构建完毕，defer 脚本执行完成之后，DOMContentLoaded 事件触发。 

#### Async脚本

![domcontentloaded_async](img/domcontentloaded_async.png)

若 HTML 文档被解析时如果遇见 async 脚本，则在后台加载脚本，文档解析过程不中断。脚本加载完成后，文档停止解析，脚本执行，执行结束后文档继续解析。

若HTML 解析完了之后，async脚本才加载完成，不需要等待脚本执行，直接触发DOMContentLoaded事件。

#### 总结

defer和async都会异步加载js，DOMContentLoaded一定会等待defer脚本执行完之后（并且在dom解析完毕之后才执行）才会触发，而async则不会。




