
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>redux 4.0.5 · 笔记</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="hzz">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="react-redux-7.2.0.html" />
    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    前端
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" >
            
                <span>
            
                    
                    面试题
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../前端/面试题/http协议.md">
            
                <span>
            
                    
                    http 协议
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" >
            
                <span>
            
                    
                    浏览器
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../前端/浏览器/浏览器基础.html">
            
                <a href="../前端/浏览器/浏览器基础.html">
            
                    
                    浏览器基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../前端/浏览器/浏览器缓存.html">
            
                <a href="../前端/浏览器/浏览器缓存.html">
            
                    
                    浏览器缓存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../前端/浏览器/DOM基础.html">
            
                <a href="../前端/浏览器/DOM基础.html">
            
                    
                    DOM 基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="../前端/浏览器/页面渲染.html">
            
                <a href="../前端/浏览器/页面渲染.html">
            
                    
                    页面渲染
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="../前端/浏览器/Chrome调试技巧.html">
            
                <a href="../前端/浏览器/Chrome调试技巧.html">
            
                    
                    Chrome 调试技巧
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.6" data-path="../前端/浏览器/EventLoop.html">
            
                <a href="../前端/浏览器/EventLoop.html">
            
                    
                    Event Loop
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" >
            
                <span>
            
                    
                    React
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../前端/React/React基础.html">
            
                <a href="../前端/React/React基础.html">
            
                    
                    React 基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../前端/React/React最佳实践.html">
            
                <a href="../前端/React/React最佳实践.html">
            
                    
                    React 最佳实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="../前端/React/React虚拟DOM.html">
            
                <a href="../前端/React/React虚拟DOM.html">
            
                    
                    React 虚拟 DOM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.4" data-path="../前端/React/React事件机制.html">
            
                <a href="../前端/React/React事件机制.html">
            
                    
                    React 事件机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.5" data-path="../前端/React/开发实战.html">
            
                <a href="../前端/React/开发实战.html">
            
                    
                    开发实战
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" >
            
                <span>
            
                    
                    JS
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="../前端/JS/Blob.md">
            
                <span>
            
                    
                    Blob
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="../前端/JS/JS用法.md">
            
                <span>
            
                    
                    JS 用法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="../前端/JS/ES6.md">
            
                <span>
            
                    
                    ES6
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.4" data-path="../前端/JS/javascript.md">
            
                <span>
            
                    
                    Javascript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.5" data-path="../前端/JS/异步.md">
            
                <span>
            
                    
                    异步
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.6" data-path="../前端/JS/手写代码.html">
            
                <a href="../前端/JS/手写代码.html">
            
                    
                    手写代码
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5" >
            
                <span>
            
                    
                    CSS 基础
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.1" data-path="../前端/CSS/CSS基础.html">
            
                <a href="../前端/CSS/CSS基础.html">
            
                    
                    CSS 基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.2" data-path="../前端/CSS/Flex.html">
            
                <a href="../前端/CSS/Flex.html">
            
                    
                    Flex
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.3" data-path="../前端/CSS/BFC.html">
            
                <a href="../前端/CSS/BFC.html">
            
                    
                    BFC
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.6" >
            
                <span>
            
                    
                    Typescript
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.6.1" data-path="../前端/TS/TS基础.md">
            
                <span>
            
                    
                    TS 基础
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.7" >
            
                <span>
            
                    
                    Webpack
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.7.1" data-path="../前端/webpack/webpack.html">
            
                <a href="../前端/webpack/webpack.html">
            
                    
                    webpack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.2" data-path="../前端/webpack/配置.html">
            
                <a href="../前端/webpack/配置.html">
            
                    
                    配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.3" data-path="../前端/webpack/plugin.html">
            
                <a href="../前端/webpack/plugin.html">
            
                    
                    plugin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.4" data-path="../前端/webpack/loader.html">
            
                <a href="../前端/webpack/loader.html">
            
                    
                    loader
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.5" data-path="../前端/webpack/优化.html">
            
                <a href="../前端/webpack/优化.html">
            
                    
                    优化
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.8" >
            
                <span>
            
                    
                    性能优化
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.8.1" data-path="../前端/性能优化/基础.html">
            
                <a href="../前端/性能优化/基础.html">
            
                    
                    基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.2" data-path="../前端/性能优化/雅虎军规.html">
            
                <a href="../前端/性能优化/雅虎军规.html">
            
                    
                    雅虎军规
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.3" data-path="../前端/性能优化/React性能优化.html">
            
                <a href="../前端/性能优化/React性能优化.html">
            
                    
                    React 性能优化
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    源码
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.3.1" data-path="redux-4.0.5.html">
            
                <a href="redux-4.0.5.html">
            
                    
                    redux 4.0.5
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="react-redux-7.2.0.html">
            
                <a href="react-redux-7.2.0.html">
            
                    
                    react redux 7.2.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="react-router-5.1.2.html">
            
                <a href="react-router-5.1.2.html">
            
                    
                    react router 5.1.2
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../后端/SUMMARY.html">
            
                <a href="../后端/SUMMARY.html">
            
                    
                    后端
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../DevOps/SUMMARY.html">
            
                <a href="../DevOps/SUMMARY.html">
            
                    
                    DevOps
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../DevOps/nginx.html">
            
                <a href="../DevOps/nginx.html">
            
                    
                    nginx
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >redux 4.0.5</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>&#x672C;&#x6587;&#x662F;&#x57FA;&#x4E8E;redux 4.0.5&#x7684;&#x6E90;&#x7801;&#x505A;&#x7684;&#x89E3;&#x6790;&#xFF0C;&#x6E90;&#x7801;&#x4E0D;&#x591A;&#xFF0C;&#x76EE;&#x5F55;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="img/redux-4.0.5-src.png" alt="redux&#x76EE;&#x5F55; "></p>
<h2 id="utils">utils</h2>
<h3 id="actiontypesjs">actionTypes.js</h3>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> randomString = () =&gt;
  <span class="hljs-built_in">Math</span>.random()
    .toString(<span class="hljs-number">36</span>)
    .substring(<span class="hljs-number">7</span>)
    .split(<span class="hljs-string">&apos;&apos;</span>)
    .join(<span class="hljs-string">&apos;.&apos;</span>)

<span class="hljs-keyword">const</span> ActionTypes = {
  INIT: <span class="hljs-string">`@@redux/INIT<span class="hljs-subst">${randomString()}</span>`</span>,
  REPLACE: <span class="hljs-string">`@@redux/REPLACE<span class="hljs-subst">${randomString()}</span>`</span>,
  PROBE_UNKNOWN_ACTION: () =&gt; <span class="hljs-string">`@@redux/PROBE_UNKNOWN_ACTION<span class="hljs-subst">${randomString()}</span>`</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> ActionTypes
</code></pre>
<p>&#x8BE5;&#x6587;&#x4EF6;&#x9996;&#x5148;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x4EA7;&#x751F;&#x968F;&#x673A;&#x6570;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x5B9A;&#x4E49;&#x4E86;&#x4E09;&#x4E2A;&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7684;ActionType&#x3002;</p>
<h3 id="isplainobjectjs">isPlainObject.js</h3>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isPlainObject</span>(<span class="hljs-params">obj</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">&apos;object&apos;</span> || obj === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>

  <span class="hljs-keyword">let</span> proto = obj
  <span class="hljs-keyword">while</span> (<span class="hljs-built_in">Object</span>.getPrototypeOf(proto) !== <span class="hljs-literal">null</span>) {
    proto = <span class="hljs-built_in">Object</span>.getPrototypeOf(proto)
  }

  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.getPrototypeOf(obj) === proto
}
</code></pre>
<p>&#x5224;&#x65AD;&#x662F;&#x5426;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x5BF9;&#x8C61;&#xFF0C;&#x4EC0;&#x4E48;&#x662F;&#x7B80;&#x5355;&#x5BF9;&#x8C61;&#x5462;&#xFF1F;&#x5C31;&#x662F;&#x7531;Object&#x6784;&#x9020;&#x51FD;&#x6570;&#x6216;&#x8005;&#x5B57;&#x9762;&#x91CF;&#x65B9;&#x5F0F;&#x521B;&#x5EFA;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5373;<code>obj.__proto__ === Object.protype</code> &#x3002;</p>
<blockquote>
<p>&#x6211;&#x7684;&#x89E3;&#x8BFB;&#xFF1A;&#x4E0A;&#x9762;&#x7684;&#x610F;&#x601D;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x539F;&#x578B;&#x94FE;&#x6DF1;&#x5EA6;&#x53EA;&#x6709;&#x4E00;&#x5C42;&#xFF0C;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x53EA;&#x6709;Object&#x624D;&#x80FD;&#x6EE1;&#x8DB3;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x4EBA;&#x4E3A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x539F;&#x578B;&#x4E3A;null&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6765;&#x7EC8;&#x6B62;&#x539F;&#x578B;&#x94FE;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5148;&#x770B;&#x4E0B; lodash &#x4E2D; <a href="https://lodash.com/docs/4.17.15#isPlainObject" target="_blank">isPlainObject</a> &#x7684;&#x89E3;&#x91CA;&#xFF1A;</p>
<p><code>_.isPlainObject(value)</code></p>
<p> Checks if <code>value</code> is a plain object, that is, an object created by the <code>Object</code> constructor or one with a <code>[[Prototype]]</code> of <code>null</code>. </p>
<p>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x7531;Object&#x521B;&#x5EFA;&#x7684;&#x5BF9;&#x8C61;&#x6216;&#x8005;&#x5B57;&#x9762;&#x91CF;&#x5BF9;&#x8C61;&#xFF0C;&#x4EE5;&#x53CA;&#x7531;&#x6CA1;&#x6709;&#x539F;&#x578B;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6240;&#x521B;&#x5EFA;</p>
<pre><code class="lang-js">_.isPlainObject([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
<span class="hljs-comment">// =&gt; false</span>

_.isPlainObject({ <span class="hljs-string">&apos;x&apos;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&apos;y&apos;</span>: <span class="hljs-number">0</span> });
<span class="hljs-comment">// =&gt; true</span>

_.isPlainObject(<span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>));
<span class="hljs-comment">// =&gt; true</span>

<span class="hljs-comment">// &#x8865;&#x5145;&#xFF1A;Object.create&#x5BF9;&#x5E94;&#x7684;&#x539F;&#x7406;&#x5982;&#x4E0B;&#xFF0C;&#x5373;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x4EE5;&#x53C2;&#x6570;&#x4E3A;&#x539F;&#x578B;</span>
<span class="hljs-built_in">Object</span>.create =  <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">o</span>) </span>{
    <span class="hljs-keyword">var</span> F = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{};
    F.prototype = o;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> F();
};
</code></pre>
</blockquote>
<p>&#x53EA;&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC;&#x6709;&#x70B9;&#x7591;&#x95EE;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x8FD9;&#x4E48;&#x5199;&#x5462;&#xFF1F;</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> proto = <span class="hljs-built_in">Object</span>.getPrototypeOf(obj);
<span class="hljs-keyword">return</span> proto === <span class="hljs-built_in">Object</span>.prototype || proto === <span class="hljs-literal">null</span>
</code></pre>
<h3 id="warningjs">warning.js</h3>
<p>&#x6253;&#x5370;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF0C;&#x9002;&#x914D;&#x4E86;console&#x5728;ie&#x4F4E;&#x7248;&#x672C;&#x4E2D;&#x7684;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;</p>
<h2 id="indexjs">index.js</h2>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> createStore <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./createStore&apos;</span>
<span class="hljs-keyword">import</span> combineReducers <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./combineReducers&apos;</span>
<span class="hljs-keyword">import</span> bindActionCreators <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./bindActionCreators&apos;</span>
<span class="hljs-keyword">import</span> applyMiddleware <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./applyMiddleware&apos;</span>
<span class="hljs-keyword">import</span> compose <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./compose&apos;</span>
<span class="hljs-keyword">import</span> warning <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./utils/warning&apos;</span>
<span class="hljs-keyword">import</span> __DO_NOT_USE__ActionTypes <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./utils/actionTypes&apos;</span>

<span class="hljs-comment">// &#x7701;&#x53BB;&#x975E;&#x91CD;&#x8981;&#x7684;&#x4EE3;&#x7801;</span>

<span class="hljs-keyword">export</span> {
  createStore,
  combineReducers,
  bindActionCreators,
  applyMiddleware,
  compose,
  __DO_NOT_USE__ActionTypes
}
</code></pre>
<p>&#x8BE5;&#x6587;&#x4EF6;&#x662F;&#x6574;&#x4E2A;redux&#x7684;&#x5165;&#x53E3;&#x6587;&#x4EF6;&#xFF0C;&#x66B4;&#x9732;&#x4E86;&#x5F88;&#x591A;&#x65B9;&#x6CD5;&#xFF0C;&#x6BCF;&#x4E2A;&#x65B9;&#x6CD5;&#x90FD;&#x5728;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x4E2A;&#x4E2A;&#x7684;&#x770B;&#x3002;</p>
<h3 id="createstorejs">createStore.js</h3>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createStore</span>(<span class="hljs-params">reducer, preloadedState, enhancer</span>) </span>{

  <span class="hljs-comment">// ... &#x7701;&#x7565;&#x90E8;&#x5206;&#x4EE3;&#x7801;</span>

  <span class="hljs-keyword">let</span> currentReducer = reducer            <span class="hljs-comment">// &#x5F53;&#x524D;&#x7684;reducer</span>
  <span class="hljs-keyword">let</span> currentState = preloadedState        <span class="hljs-comment">// store&#x7684;&#x5F53;&#x524D;&#x72B6;&#x6001;</span>
  <span class="hljs-keyword">let</span> currentListeners = []             <span class="hljs-comment">// &#x5F53;&#x524D;&#x8BA2;&#x9605;&#x5217;&#x8868;</span>
  <span class="hljs-keyword">let</span> nextListeners = currentListeners  <span class="hljs-comment">// &#x65B0;&#x7684;&#x8BA2;&#x9605;&#x5217;&#x8868;</span>
  <span class="hljs-keyword">let</span> isDispatching = <span class="hljs-literal">false</span>             <span class="hljs-comment">// &#x4F5C;&#x4E3A;&#x9501;&#x6765;&#x7528;</span>

  <span class="hljs-comment">// ... &#x7701;&#x7565;&#x4E86;&#x9700;&#x8981;&#x5230;&#x5904;&#x7684;&#x51FD;&#x6570;&#x5B9A;&#x4E49;</span>

  dispatch({ type: ActionTypes.INIT })

  <span class="hljs-keyword">return</span> {
    dispatch,
    subscribe,
    getState,
    replaceReducer,
    [$$observable]: observable
  }
}
</code></pre>
<p>&#x7531;&#x6B64;&#x53EF;&#x89C1;&#xFF0C;createStore&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x95ED;&#x5305;&#x73AF;&#x5883;&#xFF0C;&#x66B4;&#x9732;&#x4E86;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;&#x5185;&#x90E8;&#x904D;&#x5386;&#x7684;&#x51FD;&#x6570;&#x3002;createStore&#x7684;&#x524D;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x5F88;&#x597D;&#x7406;&#x89E3;&#xFF0C;&#x7B2C;&#x4E09;&#x4E2A;&#x53C2;&#x6570;enhancer&#x610F;&#x601D;&#x4E3A;&#x589E;&#x5F3A;&#x5668;&#xFF0C;&#x6765;&#x589E;&#x5F3A;redux&#x7684;&#xFF0C;&#x4E0B;&#x9762;&#x5C06;&#x4F1A;&#x4ECB;&#x7ECD;&#x3002;</p>
<p>createStore&#x4E5F;&#x9002;&#x914D;&#x4E86;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x60C5;&#x5F62;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;&#xFF0C;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> preloadedState === <span class="hljs-string">&apos;function&apos;</span> &amp;&amp; <span class="hljs-keyword">typeof</span> enhancer === <span class="hljs-string">&apos;undefined&apos;</span>) {
  enhancer = preloadedState
  preloadedState = <span class="hljs-literal">undefined</span>
}
</code></pre>
<h4 id="getstate">getState</h4>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getState</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">if</span> (isDispatching) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(
      <span class="hljs-string">&apos;You may not call store.getState() while the reducer is executing. &apos;</span> +
      <span class="hljs-string">&apos;The reducer has already received the state as an argument. &apos;</span> +
      <span class="hljs-string">&apos;Pass it down from the top reducer instead of reading it from the store.&apos;</span>
    )
  }
  <span class="hljs-comment">// &#x7531;&#x6B64;&#x53EF;&#x770B;&#x51FA;&#xFF0C;&#x6B64;&#x5904;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x4E86;&#x5185;&#x90E8;&#x5BF9;&#x8C61;&#xFF0C;&#x975E;&#x526F;&#x672C;&#xFF0C;&#x7406;&#x8BBA;&#x4E0A;&#x53EF;&#x4FEE;&#x6539;&#x5185;&#x90E8;state&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x4F1A;&#x8FDB;&#x884C;&#x4E8B;&#x4EF6;&#x901A;&#x77E5;</span>
  <span class="hljs-keyword">return</span> currentState
}
</code></pre>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x5F53;&#x5728;&#x8FDB;&#x884C;reducer&#x64CD;&#x4F5C;&#x65F6;&#x83B7;&#x53D6;state&#xFF0C;&#x5219;&#x4F1A;&#x62A5;&#x9519;&#x3002;&#x8BE5;&#x51FD;&#x6570;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x5185;&#x90E8;&#x72B6;&#x6001;currentState&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x505A;&#x62F7;&#x8D1D;&#x52A8;&#x4F5C;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x91CC;&#x5F97;&#x5230;&#x7684;state&#x662F;&#x53EF;&#x4EE5;&#x88AB;&#x66F4;&#x6539;&#x7684;&#xFF0C;&#x4F46;&#x662F;redux&#x4E0D;&#x5141;&#x8BB8;&#x8FD9;&#x4E48;&#x505A;&#x3002;</p>
<h4 id="dispatch">dispatch</h4>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dispatch</span>(<span class="hljs-params">action</span>) </span>{
  <span class="hljs-comment">// &#x7701;&#x7565;&#x4EE3;&#x7801;&#xFF1A;&#x5224;&#x65AD;&#x662F;&#x5426;&#x662F;plainObject&#xFF0C;&#x5224;&#x65AD;action&#x662F;&#x5426;&#x6709;type&#x5C5E;&#x6027;</span>

  <span class="hljs-keyword">if</span> (isDispatching) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&apos;Reducers may not dispatch actions.&apos;</span>)
  }

  <span class="hljs-keyword">try</span> {
    isDispatching = <span class="hljs-literal">true</span>
    currentState = currentReducer(currentState, action)
  } <span class="hljs-keyword">finally</span> {
    isDispatching = <span class="hljs-literal">false</span>
  }

  <span class="hljs-comment">// &#x901A;&#x77E5;&#x6BCF;&#x4E00;&#x4E2A;listener</span>
  <span class="hljs-comment">// &#x6CE8;&#x610F;currentListeners = nextListeners&#x8FD9;&#x4E00;&#x6B65;&#x64CD;&#x4F5C;&#xFF0C;&#x540E;&#x9762;&#x4F1A;&#x63D0;&#x5230;</span>
  <span class="hljs-keyword">const</span> listeners = (currentListeners = nextListeners)
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; listeners.length; i++) {
    <span class="hljs-keyword">const</span> listener = listeners[i]
    listener()
  }

  <span class="hljs-keyword">return</span> action
}
</code></pre>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;dispatch&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x5C31;&#x662F;&#x8C03;&#x7528;reducer&#xFF0C;&#x7136;&#x540E;&#x901A;&#x77E5;&#x6240;&#x6709;&#x8BA2;&#x9605;&#x7684;&#x76D1;&#x542C;&#x8005;&#xFF0C;listener&#x662F;&#x6CA1;&#x6709;&#x56DE;&#x8C03;&#x53C2;&#x6570;&#x7684;&#x3002;&#x540C;&#x6837;isDispatch&#x8D77;&#x5230;&#x9501;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x5F53;&#x6267;&#x884C;reducer&#x65F6;&#x4E3A;true&#x3002;</p>
<h4 id="subscribe">subscribe</h4>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subscribe</span>(<span class="hljs-params">listener</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> listener !== <span class="hljs-string">&apos;function&apos;</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&apos;Expected the listener to be a function.&apos;</span>)
  }

  <span class="hljs-keyword">if</span> (isDispatching) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&apos;xxx&apos;</span>)
  }

  <span class="hljs-comment">// listener&#x7684;&#x8BA2;&#x9605;&#x72B6;&#x6001;</span>
  <span class="hljs-keyword">let</span> isSubscribed = <span class="hljs-literal">true</span>

  ensureCanMutateNextListeners()
  nextListeners.push(listener)

  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unsubscribe</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (!isSubscribed) {
      <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">if</span> (isDispatching) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&apos;xxx&apos;</span>)
    }

    isSubscribed = <span class="hljs-literal">false</span>

    ensureCanMutateNextListeners()
    <span class="hljs-keyword">const</span> index = nextListeners.indexOf(listener)
    nextListeners.splice(index, <span class="hljs-number">1</span>)
    currentListeners = <span class="hljs-literal">null</span>
  }
}
</code></pre>
<p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x5982;&#x679C;&#x6B63;&#x5728;&#x6267;&#x884C;reducer&#x7684;&#x65F6;&#x5019;&#x662F;&#x4E0D;&#x5141;&#x8BB8;&#x8FDB;&#x884C;&#x8BA2;&#x9605;&#x7684;&#x3002;&#x6CE8;&#x610F;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x53D6;&#x6D88;&#x8BE5;&#x8BA2;&#x9605;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x901A;&#x8FC7;&#x95ED;&#x5305;&#x5B9E;&#x73B0;&#x3002;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x770B;&#x4E0B;ensureCanMutateNextListeners&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ensureCanMutateNextListeners</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">if</span> (nextListeners === currentListeners) {
    nextListeners = currentListeners.slice()
  }
}
</code></pre>
<p>&#x5F53;nextListeners &#x548C; currentListeners&#x4E3A;&#x540C;&#x4E00;&#x5F15;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5219;&#x5BF9;currentListeners&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x6D45;&#x62F7;&#x8D1D;&#xFF0C;&#x4FDD;&#x8BC1;nextListeners&#x662F;&#x53EF;&#x4EE5;&#x66F4;&#x6539;&#x7684;&#x3002;&#x56E0;&#x4E3A;&#x5728;dispatch&#x7684;&#x6700;&#x540E;&#xFF0C;&#x4F1A;&#x5C06;currentListeners&#x6307;&#x5411;nextListeners&#xFF0C;&#x8C03;&#x7528;&#x6240;&#x6709;&#x7684;&#x76D1;&#x542C;&#x51FD;&#x6570;&#xFF0C;&#x6B64;&#x65F6;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;currentListeners&#x4E0D;&#x88AB;&#x4FEE;&#x6539;&#xFF0C;&#x4E71;&#x5E8F;&#x5BFC;&#x81F4;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#xFF0C;&#x6545;&#x6BCF;&#x5F53;&#x9700;&#x8981;&#x5BF9;listeners&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5747;&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x6D45;&#x62F7;&#x8D1D;&#x64CD;&#x4F5C;&#xFF0C;&#x8D77;&#x5230;&#x4E00;&#x4E2A;&#x7F13;&#x5B58;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6240;&#x6709;&#x7684;&#x64CD;&#x4F5C;&#x9488;&#x5BF9;&#x7F13;&#x5B58;&#x7684;&#xFF0C;&#x5F53;&#x9700;&#x8981;&#x904D;&#x5386;&#x6267;&#x884C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5219;&#x53D6;&#x6700;&#x65B0;&#x6570;&#x636E;&#x3002;</p>
<h4 id="replacereducer">replaceReducer</h4>
<p>&#x66F4;&#x6539;reducer&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x5F88;&#x5C11;&#x7528;&#x5230;&#x3002;</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">replaceReducer</span>(<span class="hljs-params">nextReducer</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> nextReducer !== <span class="hljs-string">&apos;function&apos;</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&apos;Expected the nextReducer to be a function.&apos;</span>)
  }

  currentReducer = nextReducer

  <span class="hljs-comment">// This action has a similiar effect to ActionTypes.INIT.</span>
  <span class="hljs-comment">// Any reducers that existed in both the new and old rootReducer</span>
  <span class="hljs-comment">// will receive the previous state. This effectively populates</span>
  <span class="hljs-comment">// the new state tree with any relevant data from the old one.</span>
  dispatch({ type: ActionTypes.REPLACE })
}
</code></pre>
<h4 id="actiontypesinit">ActionTypes.INIT</h4>
<p>&#x5728;createStore&#x51FD;&#x6570;&#x7684;&#x672B;&#x5C3E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;dispatch&#x4E86;&#x8FD9;&#x6837;&#x7684;&#x4E00;&#x4E2A;action</p>
<pre><code class="lang-js">dispatch({ type: ActionTypes.INIT })
</code></pre>
<p>&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;currentState&#x4E3A;undefined&#xFF0C;&#x53D1;&#x4E86;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;action&#x662F;&#x4E3A;&#x4E86;&#x62FF;&#x5230;state&#x7684;&#x521D;&#x59CB;&#x72B6;&#x6001;&#x5BF9;&#x8C61;&#x3002;</p>
<h3 id="applymiddleware--enhancer">applyMiddleware &amp; enhancer</h3>
<blockquote>
<p>&#x8FD9;&#x90E8;&#x5206;&#x662F;Redux&#x7684;&#x7CBE;&#x534E;&#xFF0C;&#x4E5F;&#x662F;&#x5341;&#x5206;&#x96BE;&#x4EE5;&#x7406;&#x89E3;&#x7684;&#x5730;&#x65B9;&#x3002;&#x91CD;&#x70B9;&#x7406;&#x89E3;&#x3002;</p>
</blockquote>
<p>&#x901A;&#x8FC7;enhancer&#x7684;&#x8C03;&#x7528;&#x65B9;&#x5F0F;<code>enhancer(createStore)(reducer, preloadedState)</code>&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;enhancer&#x662F;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x4EE5;createStore&#x4E3A;&#x53C2;&#x6570;&#x7684;&#x52A0;&#x5F3A;&#x7248;&#x672C;&#x7684;createStore&#x51FD;&#x6570;&#x3002;&#x800C;applyMiddleware&#x5C31;&#x662F;&#x7528;&#x6765;&#x9002;&#x914D;middleware&#x8FD4;&#x56DE;enhancer&#x51FD;&#x6570;&#x7684;&#x3002;</p>
<p>&#x6700;&#x96BE;&#x7406;&#x89E3;&#x7684;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;    </p>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">applyMiddleware</span>(<span class="hljs-params">...middlewares</span>) </span>{

  <span class="hljs-comment">// &#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x9AD8;&#x9636;&#x51FD;&#x6570;</span>
  <span class="hljs-keyword">return</span> createStore =&gt; (...args) =&gt; {
    <span class="hljs-keyword">const</span> store = createStore(...args)
    <span class="hljs-keyword">let</span> dispatch = () =&gt; {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(
        <span class="hljs-string">&apos;Dispatching while constructing your middleware is not allowed. &apos;</span> +
          <span class="hljs-string">&apos;Other middleware would not be applied to this dispatch.&apos;</span>
      )
    }

    <span class="hljs-keyword">const</span> middlewareAPI = {
      getState: store.getState,
      dispatch: (...args) =&gt; dispatch(...args)
    }

    <span class="hljs-keyword">const</span> chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))
    dispatch = compose(...chain)(store.dispatch)

    <span class="hljs-comment">// applyMiddleware&#x4E3B;&#x8981;&#x662F;&#x5BF9;dispatch&#x7684;&#x88C5;&#x9970;</span>
    <span class="hljs-keyword">return</span> {
      ...store,
      dispatch
    }
  }
}
</code></pre>
<p>&#x6E29;&#x4E60;&#x4E00;&#x4E0B;compose&#x51FD;&#x6570;&#xFF1A;</p>
<pre><code class="lang-js">compose(f, g) = (...args) =&gt; f(g(..args));
<span class="hljs-comment">// &#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x628A;&#x53C2;&#x6570;&#x6362;&#x6210;next&#xFF0C;next&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x662F;&#x589E;&#x5F3A;&#x7248;&#x672C;&#x7684;dispatch&#x51FD;&#x6570;</span>
compose(f, g) = next =&gt; f(g(next));
</code></pre>
<p>&#x73B0;&#x5728;&#x770B;&#x5982;&#x4E0B;&#x4E24;&#x884C;&#x5173;&#x952E;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-comment">// &#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#x6700;&#x7B80;&#x5355;&#x7684;&#x5F62;&#x5F0F;&#xFF1A;store =&gt; next =&gt; action =&gt; next(action)</span>
<span class="hljs-comment">// &#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x4E00;&#x5C42;&#x8BA1;&#x7B97;&#xFF0C;&#x6BCF;&#x4E2A;&#x51FD;&#x6570;&#x53D8;&#x6210;&#xFF1A;next =&gt; action =&gt; next(action)</span>
<span class="hljs-comment">// &#x5373;&#x4F20;&#x5165;&#x4E00;&#x4E2A;dispatch&#x51FD;&#x6570;&#xFF0C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;dispatch&#x51FD;&#x6570;</span>
<span class="hljs-keyword">const</span> chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))
<span class="hljs-comment">// &#x5982;&#x4E0B;&#x8FD9;&#x53E5;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x901A;&#x8FC7;&#x4E2D;&#x95F4;&#x4EF6;&#x5BF9;dispatch&#x51FD;&#x6570;&#x505A;&#x4E86;&#x5C42;&#x5C42;&#x589E;&#x5F3A;&#x540E;&#x7684;dispatch&#x51FD;&#x6570;</span>
<span class="hljs-comment">// next&#x53EF;&#x770B;&#x4F5C;&#x662F;&#x4E0A;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#x4FEE;&#x9970;&#x751F;&#x6210;&#x7684;dispatch&#x51FD;&#x6570;&#xFF0C;&#x521D;&#x59CB;&#x7684;next&#x51FD;&#x6570;&#x5C31;&#x662F;store.dispatch</span>
<span class="hljs-comment">// dispatch&#x4FEE;&#x9970;&#x662F;&#x4ECE;&#x53F3;&#x5230;&#x5DE6;&#xFF0C;dispatch&#x7684;&#x6267;&#x884C;&#x662F;&#x4ECE;&#x5DE6;&#x5230;&#x53F3;</span>
dispatch = compose(...chain)(store.dispatch)
</code></pre>
<h3 id="combinereducersjs">combineReducers.js</h3>
<p>&#x53C2;&#x6570;reducers&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x7C7B;&#x4F3C;&#x5982;&#x4E0B;&#x5F62;&#x5F0F;&#xFF0C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x4EE3;&#x7406;&#x6240;&#x6709;reducers&#x7684;&#x51FD;&#x6570;&#x3002;</p>
<pre><code class="lang-json">{
    key1: reducer1(),
  key2: reducer2()
}
</code></pre>
<p>&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF0C;&#x53EA;&#x4FDD;&#x7559;&#x5173;&#x952E;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">combineReducers</span>(<span class="hljs-params">reducers</span>) </span>{
  <span class="hljs-keyword">const</span> reducerKeys = <span class="hljs-built_in">Object</span>.keys(reducers)
  <span class="hljs-keyword">const</span> finalReducers = {}

  <span class="hljs-comment">// &#x627E;&#x51FA;&#x6240;&#x6709;&#x662F;&#x51FD;&#x6570;&#x7684;reducer</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; reducerKeys.length; i++) {
    <span class="hljs-keyword">const</span> key = reducerKeys[i]

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> reducers[key] === <span class="hljs-string">&apos;function&apos;</span>) {
      finalReducers[key] = reducers[key]
    }
  }
  <span class="hljs-keyword">const</span> finalReducerKeys = <span class="hljs-built_in">Object</span>.keys(finalReducers)

  <span class="hljs-keyword">let</span> shapeAssertionError
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// &#x4FDD;&#x8BC1;&#x6BCF;&#x4E2A;reducer&#x6709;&#x521D;&#x59CB;&#x503C;&#xFF0C;&#x5BF9;&#x4E8E;&#x4EFB;&#x610F;&#x7C7B;&#x578B;action&#x90FD;&#x6709;&#x8FD4;&#x56DE;&#x503C;</span>
    assertReducerShape(finalReducers)
  } <span class="hljs-keyword">catch</span> (e) {
    shapeAssertionError = e
  }

  <span class="hljs-comment">// &#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#x6240;&#x6709;&#x7684;reducer&#x7684;&#x51FD;&#x6570;</span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">combination</span>(<span class="hljs-params">state = {}, action</span>) </span>{
    <span class="hljs-keyword">if</span> (shapeAssertionError) {
      <span class="hljs-keyword">throw</span> shapeAssertionError
    }

    <span class="hljs-keyword">let</span> hasChanged = <span class="hljs-literal">false</span>  
    <span class="hljs-keyword">const</span> nextState = {}
    <span class="hljs-comment">// &#x904D;&#x5386;&#xFF0C;&#x6267;&#x884C;&#x6BCF;&#x4E00;&#x4E2A;reducer</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; finalReducerKeys.length; i++) {
      <span class="hljs-comment">// &#x6839;&#x636E;&#x5B83;&#x4EEC;&#x7684; key &#x6765;&#x7B5B;&#x9009;&#x51FA; state &#x4E2D;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x6570;&#x636E;&#x5E76;&#x5904;&#x7406;</span>
      <span class="hljs-keyword">const</span> key = finalReducerKeys[i]
      <span class="hljs-comment">// &#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;reducer</span>
      <span class="hljs-keyword">const</span> reducer = finalReducers[key]
      <span class="hljs-keyword">const</span> previousStateForKey = state[key]
      <span class="hljs-keyword">const</span> nextStateForKey = reducer(previousStateForKey, action)

      nextState[key] = nextStateForKey
      <span class="hljs-comment">// &#x53EA;&#x8981;&#x6709;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x5B50;state&#x53D8;&#x5316;&#xFF0C;hasChanged&#x4E3A;true</span>
      hasChanged = hasChanged || nextStateForKey !== previousStateForKey
    }
    hasChanged =
      hasChanged || finalReducerKeys.length !== <span class="hljs-built_in">Object</span>.keys(state).length
    <span class="hljs-keyword">return</span> hasChanged ? nextState : state
  }
}
</code></pre>
<h3 id="composejs">compose.js</h3>
<p>&#x7EC4;&#x5408;&#x51FD;&#x6570;</p>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compose</span>(<span class="hljs-params">...funcs</span>) </span>{
  <span class="hljs-keyword">if</span> (funcs.length === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> arg =&gt; arg
  }

  <span class="hljs-keyword">if</span> (funcs.length === <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> funcs[<span class="hljs-number">0</span>]
  }

  <span class="hljs-keyword">return</span> funcs.reduce((a, b) =&gt; (...args) =&gt; a(b(...args)))
}
</code></pre>
<h3 id="bindactioncreatorsjs">bindActionCreators.js</h3>
<p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x8F85;&#x52A9;&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x4E00;&#x4E2A;actionCreators&#x6620;&#x5C04;&#x6210;&#x4E00;&#x4E2A;&#x4E2A;&#x81EA;&#x52A8;dispatch&#x7684;&#x51FD;&#x6570;</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bindActionCreator</span>(<span class="hljs-params">actionCreator, dispatch</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> dispatch(actionCreator.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>))
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bindActionCreators</span>(<span class="hljs-params">actionCreators, dispatch</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> actionCreators === <span class="hljs-string">&apos;function&apos;</span>) {
    <span class="hljs-keyword">return</span> bindActionCreator(actionCreators, dispatch)
  }

  <span class="hljs-keyword">const</span> boundActionCreators = {}
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> actionCreators) {
    <span class="hljs-keyword">const</span> actionCreator = actionCreators[key]
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> actionCreator === <span class="hljs-string">&apos;function&apos;</span>) {
      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)
    }
  }
  <span class="hljs-keyword">return</span> boundActionCreators
}
</code></pre>
<h2 id="redux-thunk-&#x6E90;&#x7801;">redux-thunk &#x6E90;&#x7801;</h2>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createThunkMiddleware</span>(<span class="hljs-params">extraArgument</span>) </span>{
  <span class="hljs-keyword">return</span> ({ dispatch, getState }) =&gt; (next) =&gt; (action) =&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> action === <span class="hljs-string">&apos;function&apos;</span>) {
      <span class="hljs-keyword">return</span> action(dispatch, getState, extraArgument);
    }
        <span class="hljs-comment">// next&#x53EF;&#x770B;&#x4F5C;&#x662F;&#x4E0A;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#x4FEE;&#x9970;&#x751F;&#x6210;&#x7684;dispatch&#x51FD;&#x6570;</span>
    <span class="hljs-keyword">return</span> next(action);
  };
}

<span class="hljs-keyword">const</span> thunk = createThunkMiddleware();
thunk.withExtraArgument = createThunkMiddleware;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> thunk;
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
                <a href="react-redux-7.2.0.html" class="navigation navigation-next navigation-unique" aria-label="Next page: react redux 7.2.0">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"redux 4.0.5","level":"1.3.1","depth":2,"next":{"title":"react redux 7.2.0","level":"1.3.2","depth":2,"path":"源码/react-redux-7.2.0.md","ref":"源码/react-redux-7.2.0.md","articles":[]},"previous":{"title":"源码","level":"1.3","depth":1,"ref":"","articles":[{"title":"redux 4.0.5","level":"1.3.1","depth":2,"path":"源码/redux-4.0.5.md","ref":"源码/redux-4.0.5.md","articles":[]},{"title":"react redux 7.2.0","level":"1.3.2","depth":2,"path":"源码/react-redux-7.2.0.md","ref":"源码/react-redux-7.2.0.md","articles":[]},{"title":"react router 5.1.2","level":"1.3.3","depth":2,"path":"源码/react-router-5.1.2.md","ref":"源码/react-router-5.1.2.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["-lunr","-search","search-pro","expandable-chapters","code","github","splitter","-sharing"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"github":{"url":"https://github.com/babyhzz/notebook"},"search-pro":{},"expandable-chapters":{},"code":{"copyButtons":true},"splitter":{},"highlight":{},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"hzz","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"笔记","language":"zh-hans","links":{"siderbar":{"GitHub":"https://github.com/babyhzz"}},"gitbook":"*","description":"记录个人的一些笔记"},"file":{"path":"源码/redux-4.0.5.md","mtime":"2021-02-27T14:55:38.207Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-02-27T14:56:20.025Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

